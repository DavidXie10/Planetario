<div class="container">
    
    <div class="input-group rounded" style="margin-top:10px">
        <input type="text" id="search" class="form-control rounded" placeholder="Buscar por palabras claves, categorías o tópicos" aria-label="Search" autocomplete="off"
                aria-describedby="search-addon" />
        <span class="input-group-text border-0" id="search-addon">
            <i class="fas fa-search"></i>
        </span>
    </div>
    <div class="card">
        <div class="card-header">
            <h3>Actividades Educativas del Planetario </h3>
            <p class="text-start">
                <i class="fas fa-tasks"></i>
                @Html.ActionLink("Aceptar propuestas de actividades educativas", "/ActivitiesApprobation", new { @class = "btn btn-info" })

                <i class="fas fa-user-edit"></i>
                @Html.ActionLink("Agregar actividad educativa", "/ProposeEducationalActivity", new { @class = "btn btn-info" })
            </p>
        </div>
        <div class="row d-flex">
            @foreach (var activity in ViewBag.activities)
            {
                if (activity.State == "1")
                {
                    <div id="@activity.Title " class="col-4 d-flex justify-content-evenly">
                        <div id="@activity.Title" class="card rounded-3 bg-light" style="margin: 15px 0 15px 0;">
                            <div class="card-body">
                                <br>
                                <h3 class="text-start">@activity.Title  </h3>
                                <h5>Impartido por: @activity.Publisher </h5>
                                <br />
                                <h9>Fecha: @activity.Date</h9><br>
                                <h9>Duración: @activity.Duration minutos</h9><br>
                                @{
                                    string price = (@activity.Price == 0) ? "Gratis" : "₡" + @activity.Price;
                                }
                                <h9>Precio:  @price </h9><br>
                                <h9>Capacidad: @activity.MaximumCapacity personas</h9><br>
                                <h9>Tipo: @activity.ActivityType</h9><br>
                                <h9>Modalidad: @activity.TypeOfAssistance</h9><br>
                                <h9>Nivel de complejidad: @activity.ComplexityLevel</h9>
                                <span>
                                    <h5>Categoría: <a class="badge rounded-pill bg-success"> @activity.Category</a></h5>
                                    <h5>
                                        Tópicos:
                                        @foreach (var topic in activity.Topics)
                                        {
                                            <a class="badge rounded-pill bg-info"> @topic</a>
                                        }
                                    </h5>

                                </span>
                                <h5>
                                    Público Meta:
                                    @foreach (var targetAudienceInstance in activity.TargetAudience)
                                    {
                                        <a class="badge  rounded-pill bg-info"> @targetAudienceInstance</a>
                                    }
                                </h5>
                                <p class="card-text" style="margin-top: 15px;">
                                    @activity.Description
                                </p>

                            </div>
                        </div>
                    </div>
                }
            }
        </div>

        <div class="card">
            <div class="card-header"><h3>Otras actividades </h3></div>
            <div class="row d-flex">
                @foreach (var element in ViewBag.EventsToCal)
                {
                    <div class="col-4 d-flex">
                        <div class="card rounded-3 bg-light" style="margin: 15px;">
                            <div class="card-header">@element.Date | <strong>@element.Title</strong>  <br /></div>
                            <div class="card-body">
                                <p>
                                    @element.Description <br />
                                </p>
                                <div class="align-self-end align-self-right">
                                    <a href="@element.Link" class="btn btn-info">Ir a Noticia</a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

    </div>
</div>
<script>
    async function main() {
        document.getElementById("search").addEventListener("keyup", search);
    }

    function search() {
        let text = document.getElementById("search").value;      
        var activities = @Html.Raw(Json.Encode(ViewBag.activities))
        matchAllTitles(activities, text)
    }
    function matchAllTitles(activities,text) {
        var matching = new Boolean(false);
        for (var activity in activities) {
            matching = match(activities[activity].Title, text)
                || match(activities[activity].Category, text)
                || matchList(activities[activity].Topics, text)
                || match(activities[activity].ComplexityLevel, text)
                || matchList(activities[activity].TargetAudience, text);
            if (text == "")
                show(activities[activity].Title)
            else if (matching)
                show(activities[activity].Title)
            else
                hide(activities[activity].Title)       
        }
        return matching;
    }

    function matchList(list, word) {
        var matching = new Boolean(false);
        for (var element in list) {
            matching = match(list[element], word);
            if (matching)
                return matching;
        }
        return matching;
    }

    function match(word, substring) {
        return word.toLowerCase().includes(substring.toLowerCase());
    }

    function hide(elementId) {
        document.getElementById(elementId).style.display = "none";
    }

    function show(elementId) {
        console.log(document.getElementById(elementId))
        document.getElementById(elementId).style.display = "block";
    }

    main();

</script>

